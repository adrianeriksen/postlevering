<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Postlevering</title>
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            font-size: 200%;
            font-weight: 300;
            text-align: center;
        }

        ul {
            list-style-type: none;
            padding-left: 0;
        }
    </style>
</head>
<body> 
    <p id="information"></p>

    <ul id="nextDays"></ul>

    <form id="form">
        <p><label>Postnummer<br><input type="text" name="postcode" id="postcodeField"></label></p>
        <p><button type="submit">Hent leveringsdager</button></p>
    </form>

    <script>
        const WEEKDAYS = ["søndag", "mandag", "tirsdag", "onsdag", "torsdag", "fredag", "lørdag"];
        const MONTHS = ["januar", "februar", "mars", "april", "mai", "juni", "juli", "august",
            "september", "oktober", "november", "desember"];
        
        let postcode = null;

        const getToday = () => {
            const date = new Date().toISOString().slice(0, 10);
            return new Date(date);
        }

        const fetchDeliveryDays = (postcode) => {
            fetch(`https://postlevering.aer.dev/api/delivery/fetchdays?postcode=${postcode}`)
               .then(response => response.json())
               .then(content => {
                    const days = [new Date(content[0]), new Date(content[1])];
                    updateInformation(days)
               });
        }

        const onPostcodeChange = () => {
            postcode = postcodeField.value;
        }

        const onPostcodeSubmit = (event) => {
            event.preventDefault();
            fetchDeliveryDays("2000");
        }

        const getNorwegianDate = (date) => {
            _weekday = WEEKDAYS[date.getDay()];
            _date = date.getDate();
            _month = MONTHS[date.getMonth()];
            return `${_weekday} ${_date}. ${_month}`;
        }

        const updateInformation = (days) => {
            const today = getToday();
            const nextDay = days[0];

            if (nextDay.getTime() == today.getTime()) {
                document.getElementById("information").textContent = "I dag kommer posten!";
            }

            const nextDaysElement = document.getElementById("nextDays");

            const node = document.createElement("li");
            node.textContent = getNorwegianDate(nextDay);

            const node2 = document.createElement("li");
            node2.textContent = getNorwegianDate(days[1]);

            nextDaysElement.appendChild(node);
            nextDaysElement.appendChild(node2);

        }

        const form = document.getElementById("form");
        const postcodeField = document.getElementById("postcodeField");

        form.addEventListener("submit", onPostcodeSubmit);
        postcodeField.addEventListener("input", onPostcodeChange);
    </script>
</body>
</html>